<% include perm/SmallHeader %>

<% var text = { message: ' sent you a message.', like: ' liked your profile.', visit: ' visited your profile.', mutual: ' liked you back!', unlike: ' no longer likes you. Sorry.' }; %>

<div class="container">
    <div class="card">
        <div class="card-header">
            Notifications
        </div>
        <div class="card-body">
            <ul id="notifications" class="list-group">
                <% notifications.forEach(function(notification) { %>
                    <% var link = ((notification.type === 'message') ? ('/chat/' + notification.from) : ('/profile/' + notification.from)); %>
                    <li class="list-group-item"><a href="<%- link %>">
                        <%- (notification.from + text[notification.type]) %>
                    </a></li>
                <% }); %>
            </ul>
        </div>
    </div>
</div>

<% include perm/Footer %>

<script src="/socket.io/socket.io.js"></script>
<script>
    $(function () {
        var socket = io();

        socket.on('message', function (from) {
            $('#notifications').prepend('<li class="list-group-item"><a href="/chat/' + from + '"> ' + from + ' sent you a message.</a></li>' );
        });

        socket.on('like', function (from) {
            $('#notifications').prepend('<li class="list-group-item"><a href="/profile/' + from + '"> ' + from + ' liked your profile.</a></li>');
        });

        socket.on('view', function (from) {
            $('#notifications').prepend('<li class="list-group-item"><a href="/profile/' + from + '"> ' + from + ' visited your profile.</a></li>');
        });

        socket.on('mutual', function (from) {
            $('#notifications').prepend('<li class="list-group-item"><a href="/profile/' + from + '"> ' + from + '  liked you back!.</a></li>');
        });

        socket.on('unlike', function (from) {
            $('#notifications').prepend('<li class="list-group-item"><a href="/profile/' + from + '"> ' + from + '  no longer likes you. Sorry.</a></li>');
        });
    });
</script>